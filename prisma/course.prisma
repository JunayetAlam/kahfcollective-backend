model Course {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    title        String
    description  String
    status       CourseStatus @default(ACTIVE)
    language     String
    isDeleted    Boolean      @default(false)
    instructorId String       @db.ObjectId

    forums          Forum[]
    courseContents  CourseContents[]
    instructor      User             @relation(fields: [instructorId], references: [id])
    completeCourses CompleteCourse[]
    enrollCourses   EnrollCourse[]
    tierId          String           @db.ObjectId

    tier Tier @relation(fields: [tierId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("courses")
}

model CourseContents {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    type         CourseContentTypeEnum
    title        String
    description  String
    videoUrl     String?
    quizzes      Quiz[]
    status       ContentStatusEnum
    isDeleted    Boolean               @default(false)
    index        Int
    courseId     String                @db.ObjectId
    instructorId String                @db.ObjectId

    course     Course @relation(fields: [courseId], references: [id])
    instructor User   @relation(fields: [instructorId], references: [id])

    createdAt       DateTime  @default(now())
    updatedAt       DateTime  @updatedAt
    courseQuestions Question?

    @@map("course_contents")
}

model Question {
    id              String @id @default(auto()) @map("_id") @db.ObjectId
    question        String
    courseContentId String @unique @db.ObjectId
    instructorId    String @db.ObjectId

    // Relations
    courseContent   CourseContents   @relation(fields: [courseContentId], references: [id])
    instructor      User             @relation("InstructorToQuestion", fields: [instructorId], references: [id])
    questionAnswers QuestionAnswer[] @relation("QuestionToAnswer")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("questions")
}

model QuestionAnswer {
    id              String   @id @default(auto()) @map("_id") @db.ObjectId
    questionId      String   @db.ObjectId
    userId          String   @db.ObjectId
    providedAnswer  String?
    isCorrectAnswer Boolean?

    // Relations
    question Question @relation("QuestionToAnswer", fields: [questionId], references: [id])
    user     User     @relation("UserToAnswer", fields: [userId], references: [id])

    createdAt DateTime @default(now())

    @@map("question_answers")
}

model Quiz {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    courseContentId String      @db.ObjectId
    instructorId    String      @db.ObjectId
    question        String
    options         Options
    rightAnswer     RightAnswer
    isDeleted       Boolean     @default(false)
    index           Int

    courseContent CourseContents @relation(fields: [courseContentId], references: [id])
    instructor    User           @relation(fields: [instructorId], references: [id])

    createdAt   DateTime      @default(now())
    updatedAt   DateTime      @updatedAt
    quizAnswers QuizAnswers[]

    @@map("quizzes")
}

model QuizAnswers {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    quizId      String       @db.ObjectId
    userId      String       @db.ObjectId
    answer      RightAnswer
    rightAnswer RightAnswer?
    isRight     Boolean?
    isDeleted   Boolean      @default(false)
    isLocked    Boolean      @default(false)

    quiz Quiz @relation(fields: [quizId], references: [id])
    user User @relation(fields: [userId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([quizId, userId])
    @@map("quiz_answers")
}

model CompleteCourse {
    id       String @id @default(auto()) @map("_id") @db.ObjectId
    courseId String @db.ObjectId
    userId   String @db.ObjectId

    course Course @relation(fields: [courseId], references: [id])
    user   User   @relation(fields: [userId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([courseId, userId])
    @@map("course")
}

enum CourseContentTypeEnum {
    VIDEO
    QUIZ
    QUESTION
}

enum ContentStatusEnum {
    PUBLISHED
    DRAFT
}

type Options {
    A String
    B String
    C String
    D String
}

enum RightAnswer {
    A
    B
    C
    D
}

enum CourseStatus {
    DRAFT
    ACTIVE
    HIDDEN
}
